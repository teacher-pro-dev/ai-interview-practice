<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI ê¸°ë°˜ ëª¨ì˜ ë©´ì ‘ í”„ë¡œê·¸ë¨</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;500;700&display=swap');
        body { background-color: #F0F4F8; font-family: 'Noto Sans KR', sans-serif; display: flex; justify-content: center; align-items: center; height: 100vh; margin: 0; }
        .container { display: flex; width: 95%; max-width: 1400px; height: 95vh; max-height: 800px; background-color: white; border-radius: 24px; box-shadow: 0 10px 30px rgba(0,0,0,.1); overflow: hidden; }
        .video-section { flex: 6; display: flex; flex-direction: column; justify-content: space-between; align-items: center; padding: 30px; box-sizing: border-box; background-color: #fff; border-right: 1px solid #EAECEF; position: relative; }
        #countdown { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); font-size: 10em; font-weight: 700; color: rgba(255,255,255,.8); z-index: 100; display: none; text-shadow: 0 0 20px rgba(0,0,0,.5); }
        .header-info { width: 100%; z-index: 10; }
        #programTitle { font-size: 1.8em; font-weight: 700; color: #4A90E2; margin: 0 0 10px 0; }
        #usageGuide { font-size: 0.9em; color: #888; line-height: 1.6; margin: 0; padding-left: 5px; }
        .video-container { width: 100%; flex-grow: 1; display: flex; flex-direction: column; justify-content: center; align-items: center; min-height: 0; }
        #webcam { width: 100%; max-height: 100%; border-radius: 16px; background-color: #111; transform: scaleX(-1); object-fit: cover; }
        #timer { font-size: 1.5em; color: #333; font-family: 'Courier New', Courier, monospace; margin-top: 15px; }
        .controls { display: flex; gap: 15px; align-items: center; margin-top: 15px; }
        .control-item { display: flex; flex-direction: column; align-items: center; gap: 5px; }
        .control-item span { font-size: .8em; color: #888; }
        .controls button { background-color: #F0F4F8; border: none; width: 50px; height: 50px; border-radius: 50%; cursor: pointer; font-size: 1.5em; color: #4A90E2; display: flex; justify-content: center; align-items: center; transition: all .2s ease-in-out; }
        .controls button:hover { background-color: #EAECEF; transform: translateY(-2px); }
        .controls button:disabled { opacity: .5; cursor: not-allowed; }
        #recordBtn { background-color: #FF7070; color: white; width: 60px; height: 60px; font-size: 1.1em; }
        #recordBtn.recording { background-color: #4A90E2; }
        .info-section { flex: 4; background-color: #F9FAFB; padding: 30px; box-sizing: border-box; display: flex; flex-direction: column; gap: 20px; overflow-y: auto; }
        .info-section h3 { margin: 0 0 10px 0; color: #333; font-size: 1.1em; font-weight: 700; display: flex; align-items: center; gap: 8px; }
        .input-group { background: white; padding: 15px; border-radius: 12px; border: 1px solid #EAECEF; }
        .input-group input, .input-group select { width: 100%; padding: 12px; background-color: #F0F4F8; border: 1px solid #EAECEF; color: #333; border-radius: 8px; font-size: 1em; }
        #customQuestion { margin-top: 10px; }
        .output-group { background: white; padding: 15px; border-radius: 12px; border: 1px solid #EAECEF; flex-grow: 1; display: flex; flex-direction: column; }
        .output-box { overflow-y: auto; flex-grow: 1; line-height: 1.7; font-size: 0.95em; }
        #copyBtn { margin-left: auto; padding: 5px 10px; font-size: 0.8em; background-color: #4A90E2; color: white; border: none; border-radius: 5px; cursor: pointer; }
        .feedback-guide p { margin: 10px 0; font-size: 0.9em; }
        .feedback-guide a { display: block; text-align: center; padding: 15px; border-radius: 8px; text-decoration: none; font-weight: 700; font-size: 1.1em; background-color: #333; color: white; transition: background-color 0.2s; }
        .feedback-guide a:hover { background-color: #555; }
        .search-guide { margin-top: 12px; padding: 10px; background-color: #F0F4F8; border-radius: 6px; font-size: 0.85em; color: #555; line-height: 1.6; }
        @media (max-width: 900px) {
            body { height: auto; padding: 10px 0; }
            .container { flex-direction: column; height: auto; max-height: none; width: 95%; }
            .video-section { border-right: none; border-bottom: 1px solid #EAECEF; padding: 20px; }
            .info-section { padding: 20px; }
            #programTitle { font-size: 1.5em; }
            .controls button { width: 45px; height: 45px; font-size: 1.3em; }
            #recordBtn { width: 55px; height: 55px; font-size: 1em; }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="video-section">
            <div id="countdown"></div>
            <div class="header-info">
                <h1 id="programTitle">ëª¨ì˜ ë©´ì ‘ í”„ë¡œê·¸ë¨</h1>
                <p id="usageGuide">ë‹µë³€ ì¢…ë£Œ í›„ 'ë‹µë³€ ë³µì‚¬' ë²„íŠ¼ì„ ëˆ„ë¥´ê³ , 'AI ê¸°ë°˜ í”¼ë“œë°± ë°›ê¸°'ë¥¼ ëˆŒëŸ¬ ì±—ë´‡ì—ê²Œ ì§ˆë¬¸í•˜ì„¸ìš”.</p>
            </div>
            <div class="video-container">
                <video id="webcam" autoplay playsinline muted></video>
                <p id="timer">00:00</p>
            </div>
            <div class="controls">
                <div class="control-item"><button id="flipBtn" title="ì¢Œìš° ë°˜ì „">ğŸ”„</button><span>ë°˜ì „</span></div>
                <div class="control-item"><button id="pauseBtn" title="ì¼ì‹œ ì •ì§€" disabled>â¸ï¸</button><span>ì •ì§€</span></div>
                <div class="control-item"><button id="recordBtn" title="ë…¹í™” ì‹œì‘">ë…¹í™”</button></div>
                <div class="control-item"><button id="saveBtn" title="ì˜ìƒ ì €ì¥" disabled>ğŸ’¾</button><span>ì €ì¥</span></div>
            </div>
        </div>
        <div class="info-section">
            <div class="input-group"><h3>1. ì •ë³´ ì…ë ¥</h3>
                <input type="text" id="studentSchool" placeholder="ê³ ë“±í•™êµ ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš”. (ì˜ˆ: OOê³ )" style="margin-bottom: 10px;">
                <input type="text" id="studentNickname" placeholder="ê³ ìœ í•œ ë‹‰ë„¤ì„ì„ ì…ë ¥í•˜ì„¸ìš”." style="margin-bottom: 10px;">
                <select id="studentGender">
                    <option value="">ì„±ë³„ì„ ì„ íƒí•˜ì„¸ìš”.</option>
                    <option value="ë‚¨">ë‚¨ì„±</option>
                    <option value="ì—¬">ì—¬ì„±</option>
                </select>
            </div>
            <div class="input-group">
                <h3>2. ì§€ì› ëŒ€í•™êµ ë° í•™ê³¼</h3>
                <input type="text" id="university" placeholder="ì˜ˆ) OOëŒ€í•™êµ" style="margin-bottom: 10px;">
                <input type="text" id="department" placeholder="ì˜ˆ) ì¸ê³µì§€ëŠ¥í•™ê³¼">
                <button id="searchQuestionsBtn" style="width: 100%; padding: 10px; margin-top: 10px; background-color: #4A90E2; color: white; border: none; border-radius: 8px; cursor: pointer; font-size: 0.95em;">
                    ğŸ” ëŒ€í•™êµ ì„ í–‰í•™ìŠµ ì˜í–¥í‰ê°€ í™•ì¸í•˜ê¸°
                </button>
                <div class="search-guide">
                    <strong>[ì´ìš© ì•ˆë‚´]</strong><br>
                    1. ìœ„ì— ì§€ì› ëŒ€í•™ëª… ì…ë ¥ í›„ ë²„íŠ¼ì„ í´ë¦­í•˜ì„¸ìš”.<br>
                    2. 'ì–´ë””ê°€' ì‚¬ì´íŠ¸ì—ì„œ ë‹¤ì‹œ ëŒ€í•™ëª…ì„ ê²€ìƒ‰í•˜ê³  í´ë¦­í•˜ì„¸ìš”.<br>
                    3. 'ì„ í–‰í•™ìŠµ ì˜í–¥í‰ê°€' íƒ­ì—ì„œ ë³´ê³ ì„œë¥¼ ë‹¤ìš´ë°›ìœ¼ì„¸ìš”.
                </div>
            </div>
            <div class="input-group">
                <h3>3. ë©´ì ‘ ì§ˆë¬¸</h3>
                <select id="questionSelect">
                    <option value="ìê¸°ì†Œê°œ ë° ì§€ì›ë™ê¸°">ê°€. ìê¸°ì†Œê°œ ë° ì§€ì›ë™ê¸°</option>
                    <option value="ìì‹ ì˜ ì„±ê²©ì˜ ì¥ì ê³¼ ë‹¨ì ">ë‚˜. ìì‹ ì˜ ì„±ê²©ì˜ ì¥ì ê³¼ ë‹¨ì </option>
                    <option value="ì§€ì› í•™ê³¼ ê´€ë ¨ ê°€ì¥ ê¸°ì–µì— ë‚¨ëŠ” í™œë™">ë‹¤. ì§€ì› í•™ê³¼ ê´€ë ¨ ê°€ì¥ ê¸°ì–µì— ë‚¨ëŠ” í™œë™</option>
                    <option value="ì…í•™ í›„ êµ¬ì²´ì ì¸ í•™ì—… ê³„íš">ë¼. ì…í•™ í›„ êµ¬ì²´ì ì¸ í•™ì—… ê³„íš</option>
                    <option value="ë§ˆì§€ë§‰ìœ¼ë¡œ í•˜ê³  ì‹¶ì€ ë§">ë§ˆ. ë§ˆì§€ë§‰ìœ¼ë¡œ í•˜ê³  ì‹¶ì€ ë§</option>
                    <option value="custom">ë°”. (ì§ì ‘ ì…ë ¥)</option>
                </select>
                <input type="text" id="customQuestion" placeholder="ë©´ì ‘ ì§ˆë¬¸ì„ ì§ì ‘ ì…ë ¥í•˜ì„¸ìš”." style="display: none;">
            </div>
            <div class="output-group">
                <h3 style="display: flex; align-items: center;">4. í•™ìƒ ë‹µë³€ ë‚´ìš© <button id="copyBtn">ğŸ“‹ ë‹µë³€ ë³µì‚¬</button></h3>
                <div id="transcriptBox" class="output-box">ë‹µë³€ì„ ë…¹í™”í•˜ë©´ ìŒì„±ì¸ì‹ ê²°ê³¼ê°€ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤...</div>
            </div>
            <div class="output-group">
                <h3>5. AI í”¼ë“œë°± ë°›ê¸°</h3>
                <div class="output-box feedback-guide">
                    <p>1. ìœ„ 'ë‹µë³€ ë³µì‚¬' ë²„íŠ¼ì„ í´ë¦­í•˜ì„¸ìš”.<br>2. ì•„ë˜ 'í”¼ë“œë°± ë°›ê¸°' ë²„íŠ¼ì„ ëˆŒëŸ¬ ì±—ë´‡ì„ ì—¬ì„¸ìš”.<br>3. ì±—ë´‡ì—ê²Œ ë³µì‚¬í•œ ë‚´ìš©ì„ ë¶™ì—¬ë„£ê³  ì§ˆë¬¸í•˜ì„¸ìš”.</p>
                    <a href="https://chatgpt.com/g/g-68ce2135468c8191b14ed64164d81d30-ai-giban-moyi-myeonjeob-peurogeuraem" target="_blank">ğŸ¤– AI ê¸°ë°˜ í”¼ë“œë°± ë°›ê¸°</a>
                </div>
            </div>
        </div>
    </div>
<script>
    // --- 1. DOM ìš”ì†Œ ê°€ì ¸ì˜¤ê¸° ---
    const webcamVideo = document.getElementById("webcam");
    const flipBtn = document.getElementById("flipBtn");
    const pauseBtn = document.getElementById("pauseBtn");
    const recordBtn = document.getElementById("recordBtn");
    const saveBtn = document.getElementById("saveBtn");
    const timerDisplay = document.getElementById("timer");
    const questionSelect = document.getElementById("questionSelect");
    const customQuestionInput = document.getElementById("customQuestion");
    const countdownDisplay = document.getElementById("countdown");
    const transcriptBox = document.getElementById("transcriptBox");
    const copyBtn = document.getElementById("copyBtn");
    const searchQuestionsBtn = document.getElementById('searchQuestionsBtn');
    
    // --- 2. ìƒíƒœ ë³€ìˆ˜ ë° ê°ì²´ ì´ˆê¸°í™” ---
    let stream;
    let mediaRecorder;
    let recordedChunks = [];
    let isFlipped = false;
    let isPaused = false;
    let timerInterval = null;
    let seconds = 0;
    let fullTranscript = "";
    let isRecording = false; // <<< [ì¶”ê°€] ë…¹í™” ìƒíƒœë¥¼ ëª…í™•íˆ ì¶”ì í•˜ëŠ” ë³€ìˆ˜

    // --- â–¼â–¼â–¼â–¼â–¼ [í•µì‹¬ ìˆ˜ì •] ìŒì„± ì¸ì‹ API ì„¤ì • (ì•ˆì •ì„± ê°•í™” ë²„ì „) â–¼â–¼â–¼â–¼â–¼ ---
    const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
    let recognition;

    if (SpeechRecognition) {
        recognition = new SpeechRecognition();
        recognition.interimResults = true; // ì¤‘ê°„ ê²°ê³¼ëŠ” ê³„ì† ë°›ì•„ì˜´
        recognition.lang = "ko-KR";
        recognition.continuous = false; // 'ì§§ê²Œ' ì¸ì‹í•˜ê³  ìë™ ì¢…ë£Œë˜ë„ë¡ ë³€ê²½

        // ìŒì„± ì¸ì‹ ê²°ê³¼ê°€ ìˆì„ ë•Œ
        recognition.onresult = (event) => {
            let interimTranscript = "";
            for (let i = event.resultIndex; i < event.results.length; i++) {
                const transcript = event.results[i][0].transcript;
                if (event.results[i].isFinal) {
                    fullTranscript += transcript + ' ';
                } else {
                    interimTranscript += transcript;
                }
            }
            transcriptBox.innerHTML = fullTranscript + '<i style="color:#999;">' + interimTranscript + "</i>";
        };

        // ìŒì„± ì¸ì‹ì´ 'ì¢…ë£Œë  ë•Œë§ˆë‹¤' í˜¸ì¶œë˜ëŠ” ì´ë²¤íŠ¸
        recognition.onend = () => {
            // isRecording í”Œë˜ê·¸ë¥¼ í™•ì¸í•˜ì—¬, ì‚¬ìš©ìê°€ 'ì¢…ë£Œ' ë²„íŠ¼ì„ ëˆ„ë¥¸ê²Œ ì•„ë‹ˆë¼ë©´
            // ì¸ì‹ì„ ì¦‰ì‹œ ë‹¤ì‹œ ì‹œì‘í•´ì„œ ê³„ì† ì´ì–´ê°€ëŠ” íš¨ê³¼ë¥¼ ëƒ„
            if (isRecording && !isPaused) {
                recognition.start();
            }
        };
        
        recognition.onerror = (event) => {
            // ì˜¤ë¥˜ê°€ ë°œìƒí•´ë„ onendê°€ í˜¸ì¶œë˜ë¯€ë¡œ, ì—¬ê¸°ì„œëŠ” ì½˜ì†”ì— ë¡œê·¸ë§Œ ë‚¨ê¹€
            console.error("Speech recognition error:", event);
        };

    } else {
        transcriptBox.textContent = "í˜„ì¬ ë¸Œë¼ìš°ì €ì—ì„œëŠ” ìŒì„± ì¸ì‹ì„ ì§€ì›í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.";
    }
    // --- â–²â–²â–²â–²â–² ì—¬ê¸°ê¹Œì§€ í•µì‹¬ ìˆ˜ì • â–²â–²â–²â–²â–² ---


    // --- 3. í•µì‹¬ ê¸°ëŠ¥ í•¨ìˆ˜ ---
    async function setupWebcam() {
        try {
            const constraints = { 
                video: {
                    width: { ideal: 1280 },
                    height: { ideal: 720 },
                    facingMode: 'user'
                }, 
                audio: {
                    echoCancellation: true,
                    noiseSuppression: true
                } 
            };
            stream = await navigator.mediaDevices.getUserMedia(constraints);
            webcamVideo.srcObject = stream;
        } catch (err) {
            let message = "ì¹´ë©”ë¼ì™€ ë§ˆì´í¬ì— ì ‘ê·¼í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.\n";
            if (err.name === "NotAllowedError" || err.name === "PermissionDeniedError") {
                message += "ë¸Œë¼ìš°ì € ì„¤ì •ì—ì„œ ì¹´ë©”ë¼ì™€ ë§ˆì´í¬ ê¶Œí•œì„ í—ˆìš©í•´ì£¼ì„¸ìš”.";
            } else if (err.name === "NotFoundError" || err.name === "DevicesNotFoundError") {
                message += "ì—°ê²°ëœ ì¹´ë©”ë¼ë‚˜ ë§ˆì´í¬ ì¥ì¹˜ê°€ ì—†ìŠµë‹ˆë‹¤.";
            } else {
                message += `ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ${err.name}.`;
            }
            alert(message);
            console.error("Error accessing media devices.", err);
        }
    }

    function formatTime(totalSeconds) {
        const minutes = Math.floor(totalSeconds / 60);
        const seconds = totalSeconds % 60;
        return `${String(minutes).padStart(2, "0")}:${String(seconds).padStart(2, "0")}`;
    }

    function startTimer() {
        if (timerInterval) clearInterval(timerInterval);
        timerInterval = setInterval(() => {
            seconds++;
            timerDisplay.textContent = formatTime(seconds);
        }, 1000);
    }
    
    function stopTimer() {
        clearInterval(timerInterval);
        timerInterval = null;
    }

    async function sendDataToServer() {
        const webAppUrl = "https://script.google.com/macros/s/AKfycbwq_4sO5v0hxlvnoRN82cUpkOcE7XjrpoBaVUbTvdB1G9fuQufDw0jcym0gwBlKF0vw/exec";
        const schoolValue = document.getElementById("studentSchool").value.trim();
        const nicknameValue = document.getElementById("studentNickname").value.trim();
        const genderValue = document.getElementById("studentGender").value;
        let questionValue = questionSelect.options[questionSelect.selectedIndex].text;
        if (questionSelect.value === 'custom') {
            questionValue = customQuestionInput.value || "ì§ì ‘ ì…ë ¥ (ë‚´ìš© ì—†ìŒ)";
        }
        const formData = new FormData();
        formData.append('school', schoolValue);
        formData.append('nickname', nicknameValue);
        formData.append('gender', genderValue);
        formData.append('question', questionValue);
        formData.append('transcript', fullTranscript.trim() || "ë‹µë³€ ë‚´ìš© ì—†ìŒ");
        try {
            await fetch(webAppUrl, { method: 'POST', body: formData });
        } catch (error) {
            console.error('ë°ì´í„° ì „ì†¡ ì‹¤íŒ¨:', error);
            alert('ë‹µë³€ ì œì¶œì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. ì¸í„°ë„· ì—°ê²°ì„ í™•ì¸ í›„ ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.');
        }
    }

    // --- 4. ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì—°ê²° ---
    flipBtn.addEventListener("click", () => {
        isFlipped = !isFlipped;
        webcamVideo.style.transform = isFlipped ? "scaleX(1)" : "scaleX(-1)";
    });

    pauseBtn.addEventListener("click", () => {
        if (!mediaRecorder) return;
        isPaused = !isPaused; // isPaused ìƒíƒœ ë¨¼ì € ë³€ê²½
        if (isPaused) {
            mediaRecorder.pause();
            stopTimer();
            pauseBtn.innerHTML = "â–¶ï¸";
            pauseBtn.title = "ë…¹í™” ì¬ê°œ";
            if (recognition) recognition.stop(); // ì¼ì‹œì •ì§€ ì‹œ ì¸ì‹ ì¤‘ë‹¨
        } else {
            mediaRecorder.resume();
            startTimer();
            pauseBtn.innerHTML = "â¸ï¸";
            pauseBtn.title = "ì¼ì‹œ ì •ì§€";
            if (recognition) recognition.start(); // ì¬ê°œ ì‹œ ì¸ì‹ ë‹¤ì‹œ ì‹œì‘
        }
    });

    recordBtn.addEventListener("click", () => {
        if (isRecording) {
            // ë…¹í™” ì¢…ë£Œ ë¡œì§
            isRecording = false; // <<< [ìˆ˜ì •] ìƒíƒœ í”Œë˜ê·¸ ë¨¼ì € ë³€ê²½
            mediaRecorder.stop();
            if (recognition) recognition.stop();
        } else {
            // ë…¹í™” ì‹œì‘ ì „ ì •ë³´ í™•ì¸
            const schoolValue = document.getElementById("studentSchool").value.trim();
            const nicknameValue = document.getElementById("studentNickname").value.trim();
            const genderValue = document.getElementById("studentGender").value;
            if (!schoolValue || !nicknameValue || !genderValue) {
                alert("1ë²ˆ ì •ë³´ ì…ë ¥ì˜ ê³ ë“±í•™êµ, ë‹‰ë„¤ì„, ì„±ë³„ì„ ëª¨ë‘ ì…ë ¥(ì„ íƒ)í•´ì£¼ì„¸ìš”.");
                return;
            }

            // ì¹´ìš´íŠ¸ë‹¤ìš´ í›„ ë…¹í™” ì‹œì‘
            let countdown = 3;
            countdownDisplay.style.display = "block";
            countdownDisplay.textContent = countdown;
            recordBtn.disabled = true;

            const countdownInterval = setInterval(() => {
                countdown--;
                if (countdown > 0) {
                    countdownDisplay.textContent = countdown;
                } else {
                    clearInterval(countdownInterval);
                    countdownDisplay.style.display = "none";
                    recordBtn.disabled = false;
                    startRecording(); // ì‹¤ì œ ë…¹í™” ì‹œì‘ í•¨ìˆ˜ í˜¸ì¶œ
                }
            }, 1000);
        }
    });

    function startRecording() {
        isRecording = true; // <<< [ìˆ˜ì •] ë…¹í™” ì‹œì‘ ì‹œ ìƒíƒœ í”Œë˜ê·¸ true
        isPaused = false;
        recordedChunks = [];
        fullTranscript = "";
        transcriptBox.innerHTML = "ìŒì„± ì¸ì‹ì´ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤...";
        
        const options = { mimeType: 'video/webm; codecs=vp8, opus' };
        try {
            if (!MediaRecorder.isTypeSupported(options.mimeType)) {
                delete options.mimeType;
            }
            mediaRecorder = new MediaRecorder(stream, options);
        } catch (e) {
            alert("ë…¹í™” ì‹œì‘ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. ë¸Œë¼ìš°ì €ê°€ ë…¹í™” ê¸°ëŠ¥ì„ ì§€ì›í•˜ì§€ ì•Šì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.");
            isRecording = false;
            return;
        }

        mediaRecorder.ondataavailable = (event) => {
            if (event.data.size > 0) recordedChunks.push(event.data);
        };
        
        mediaRecorder.onstop = () => {
            sendDataToServer();
            
            // UI ìƒíƒœ ì—…ë°ì´íŠ¸
            recordBtn.innerHTML = "ë…¹í™”";
            recordBtn.title = "ë…¹í™” ì‹œì‘";
            recordBtn.classList.remove("recording");
            saveBtn.disabled = false;
            pauseBtn.disabled = true;
            pauseBtn.innerHTML = "â¸ï¸";
            stopTimer();
        };

        mediaRecorder.start();
        if (recognition) recognition.start();
        
        // UI ìƒíƒœ ì—…ë°ì´íŠ¸
        recordBtn.innerHTML = "ì¢…ë£Œ";
        recordBtn.title = "ë…¹í™” ì¢…ë£Œ";
        recordBtn.classList.add("recording");
        saveBtn.disabled = true;
        pauseBtn.disabled = false;
        seconds = 0;
        timerDisplay.textContent = "00:00";
        startTimer();
    }
    
    // ì´í•˜ saveBtn, questionSelect, copyBtn, searchQuestionsBtn, window.load ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆëŠ” ê¸°ì¡´ê³¼ ë™ì¼
    saveBtn.addEventListener("click", () => {
        if (recordedChunks.length === 0) {
            alert("ì €ì¥í•  ì˜ìƒ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.");
            return;
        }
        const blob = new Blob(recordedChunks, { type: "video/webm" });
        const url = URL.createObjectURL(blob);
        const a = document.createElement("a");
        const department = document.getElementById("department").value || "ë©´ì ‘ì—°ìŠµ";
        const date = new Date().toISOString().slice(0, 10);
        let questionText = questionSelect.options[questionSelect.selectedIndex].text.substring(3);
        if (questionSelect.value === 'custom') {
            questionText = customQuestionInput.value.replace(/[^a-zA-Z0-9ê°€-í£]/g, '').substring(0, 10) || "ì§ì ‘ì…ë ¥";
        }
        a.download = `${date}_${department}_${questionText}.webm`;
        a.href = url;
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
        URL.revokeObjectURL(url);
        alert("ì˜ìƒ ë‹¤ìš´ë¡œë“œê°€ ì‹œì‘ë©ë‹ˆë‹¤!");
        saveBtn.disabled = true;
    });
    questionSelect.addEventListener("change", () => {
        customQuestionInput.style.display = questionSelect.value === "custom" ? "block" : "none";
    });
    copyBtn.addEventListener('click', () => {
        if (!fullTranscript.trim()) {
            alert('ë³µì‚¬í•  ë‹µë³€ ë‚´ìš©ì´ ì—†ìŠµë‹ˆë‹¤.');
            return;
        }
        let currentQuestion = questionSelect.options[questionSelect.selectedIndex].text;
        if (questionSelect.value === "custom") {
            currentQuestion = customQuestionInput.value || "(ì§ì ‘ ì…ë ¥í•œ ì§ˆë¬¸)";
        }
        const textToCopy = `[ë©´ì ‘ ì§ˆë¬¸]\n${currentQuestion}\n\n[í•™ìƒ ë‹µë³€]\n${fullTranscript.trim()}`;
        navigator.clipboard.writeText(textToCopy).then(() => {
            copyBtn.textContent = 'âœ… ë³µì‚¬ ì™„ë£Œ!';
            setTimeout(() => { copyBtn.textContent = 'ğŸ“‹ ë‹µë³€ ë³µì‚¬'; }, 2000);
        }).catch(err => {
            const textArea = document.createElement('textarea');
            textArea.value = textToCopy;
            document.body.appendChild(textArea);
            textArea.select();
            try {
                document.execCommand('copy');
                copyBtn.textContent = 'âœ… ë³µì‚¬ ì™„ë£Œ!';
                setTimeout(() => { copyBtn.textContent = 'ğŸ“‹ ë‹µë³€ ë³µì‚¬'; }, 2000);
            } catch (e) {
                alert('ë‹µë³€ì„ ë³µì‚¬í•˜ëŠ” ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
            }
            document.body.removeChild(textArea);
        });
    });
    searchQuestionsBtn.addEventListener('click', () => {
        const universityName = document.getElementById('university').value.trim();
        if (!universityName) {
            alert('ë¨¼ì € ëŒ€í•™êµ ì´ë¦„ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');
            return;
        }
        const adigaUrl = 'https://www.adiga.kr/ucp/uvt/uni/univView.do?menuId=PCUVTINF2000';
        window.open(adigaUrl, '_blank');
    });
    window.addEventListener("load", () => {
        const participationCode = "interview2025";
        const urlParams = new URLSearchParams(window.location.search);
        const codeFromUrl = urlParams.get('code');
        const enteredCode = codeFromUrl || prompt("í”„ë¡œê·¸ë¨ ì°¸ì—¬ ì½”ë“œë¥¼ ì…ë ¥í•˜ì„¸ìš”:", "");
        if (enteredCode === participationCode) {
            setupWebcam();
        } else {
            if (codeFromUrl) {
                alert("URLì— í¬í•¨ëœ ì°¸ì—¬ ì½”ë“œê°€ ì˜¬ë°”ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤.");
            } else {
                alert("ì°¸ì—¬ ì½”ë“œê°€ ì˜¬ë°”ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤. ì‚¬ì „ ì„¤ë¬¸ ì™„ë£Œ í›„ ë°›ì€ ì½”ë“œë¥¼ í™•ì¸í•´ì£¼ì„¸ìš”.");
            }
            document.body.innerHTML = "<h1>ì ‘ê·¼ ê¶Œí•œì´ ì—†ìŠµë‹ˆë‹¤.</h1><p>ì‚¬ì „ ì„¤ë¬¸ì¡°ì‚¬ë¥¼ ë¨¼ì € ì™„ë£Œí•´ì£¼ì„¸ìš”.</p>";
        }
    });
</script>
</body>
</html>
