<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ëª¨ì˜ ë©´ì ‘ í”„ë¡œê·¸ë¨ (ìˆ˜ì •ëœ ë²„ì „)</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;500;700&display=swap');
        body { background-color: #F0F4F8; font-family: 'Noto Sans KR', sans-serif; display: flex; justify-content: center; align-items: center; height: 100vh; margin: 0; }
        .container { display: flex; width: 95%; max-width: 1400px; height: 95vh; max-height: 800px; background-color: white; border-radius: 24px; box-shadow: 0 10px 30px rgba(0,0,0,.1); overflow: hidden; }
        .video-section { flex: 6; display: flex; flex-direction: column; justify-content: space-between; align-items: center; padding: 30px; box-sizing: border-box; background-color: #fff; border-right: 1px solid #EAECEF; position: relative; }
        #countdown { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); font-size: 10em; font-weight: 700; color: rgba(255,255,255,.8); z-index: 100; display: none; text-shadow: 0 0 20px rgba(0,0,0,.5); }
        .header-info { width: 100%; z-index: 10; }
        #programTitle { font-size: 1.8em; font-weight: 700; color: #4A90E2; margin: 0 0 10px 0; }
        #usageGuide { font-size: 0.9em; color: #888; line-height: 1.6; margin: 0; padding-left: 5px; }
        .video-container { width: 100%; flex-grow: 1; display: flex; flex-direction: column; justify-content: center; align-items: center; min-height: 0; }
        #webcam { width: 100%; max-height: 100%; border-radius: 16px; background-color: #111; transform: scaleX(-1); object-fit: cover; }
        #timer { font-size: 1.5em; color: #333; font-family: 'Courier New', Courier, monospace; margin-top: 15px; }
        .controls { display: flex; gap: 15px; align-items: center; margin-top: 15px; }
        .control-item { display: flex; flex-direction: column; align-items: center; gap: 5px; }
        .control-item span { font-size: .8em; color: #888; }
        .controls button { background-color: #F0F4F8; border: none; width: 50px; height: 50px; border-radius: 50%; cursor: pointer; font-size: 1.5em; color: #4A90E2; display: flex; justify-content: center; align-items: center; transition: all .2s ease-in-out; }
        .controls button:hover { background-color: #EAECEF; transform: translateY(-2px); }
        .controls button:disabled { opacity: .5; cursor: not-allowed; }
        #recordBtn { background-color: #FF7070; color: white; width: 60px; height: 60px; font-size: 1.1em; }
        #recordBtn.recording { background-color: #4A90E2; }
        .info-section { flex: 4; background-color: #F9FAFB; padding: 30px; box-sizing: border-box; display: flex; flex-direction: column; gap: 20px; overflow-y: auto; }
        .info-section h3 { margin: 0 0 10px 0; color: #333; font-size: 1.1em; font-weight: 700; display: flex; align-items: center; gap: 8px; }
        .input-group { background: white; padding: 15px; border-radius: 12px; border: 1px solid #EAECEF; }
        .input-group input, .input-group select { width: 100%; padding: 12px; background-color: #F0F4F8; border: 1px solid #EAECEF; color: #333; border-radius: 8px; font-size: 1em; }
        #customQuestion { margin-top: 10px; }
        .output-group { background: white; padding: 15px; border-radius: 12px; border: 1px solid #EAECEF; flex-grow: 1; display: flex; flex-direction: column; }
        .output-box { overflow-y: auto; flex-grow: 1; line-height: 1.7; font-size: 0.95em; }
        #copyBtn { margin-left: auto; padding: 5px 10px; font-size: 0.8em; background-color: #4A90E2; color: white; border: none; border-radius: 5px; cursor: pointer; }
        .feedback-guide p { margin: 10px 0; font-size: 0.9em; }
        .feedback-guide a { display: block; text-align: center; padding: 15px; border-radius: 8px; text-decoration: none; font-weight: 700; font-size: 1.1em; background-color: #333; color: white; transition: background-color 0.2s; }
        .feedback-guide a:hover { background-color: #555; }
        @media (max-width: 900px) {
            body { height: auto; padding: 10px 0; }
            .container { flex-direction: column; height: auto; max-height: none; width: 95%; }
            .video-section { border-right: none; border-bottom: 1px solid #EAECEF; padding: 20px; }
            .info-section { padding: 20px; }
            #programTitle { font-size: 1.5em; }
            .controls button { width: 45px; height: 45px; font-size: 1.3em; }
            #recordBtn { width: 55px; height: 55px; font-size: 1em; }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="video-section">
            <div id="countdown"></div>
            <div class="header-info">
                <h1 id="programTitle">ëª¨ì˜ ë©´ì ‘ í”„ë¡œê·¸ë¨ (ìˆ˜ì •ëœ ë²„ì „)</h1>
                <p id="usageGuide">ë‹µë³€ ì¢…ë£Œ í›„ 'ë‹µë³€ ë³µì‚¬' ë²„íŠ¼ì„ ëˆ„ë¥´ê³ , 'AI ê¸°ë°˜ í”¼ë“œë°± ë°›ê¸°'ë¥¼ ëˆŒëŸ¬ ì±—ë´‡ì—ê²Œ ì§ˆë¬¸í•˜ì„¸ìš”.</p>
            </div>
            <div class="video-container">
                <video id="webcam" autoplay playsinline muted></video>
                <p id="timer">00:00</p>
            </div>
            <div class="controls">
                <div class="control-item"><button id="flipBtn" title="ì¢Œìš° ë°˜ì „">ğŸ”„</button><span>ë°˜ì „</span></div>
                <div class="control-item"><button id="pauseBtn" title="ì¼ì‹œ ì •ì§€" disabled>â¸ï¸</button><span>ì •ì§€</span></div>
                <div class="control-item"><button id="recordBtn" title="ë…¹í™” ì‹œì‘">ë…¹í™”</button></div>
                <div class="control-item"><button id="saveBtn" title="ì˜ìƒ ì €ì¥" disabled>ğŸ’¾</button><span>ì €ì¥</span></div>
            </div>
        </div>
        <div class="info-section">
            <div class="input-group"><h3>1. í¬ë§ í•™ê³¼</h3><input type="text" id="department" placeholder="ì˜ˆ) ì¸ê³µì§€ëŠ¥í•™ê³¼"></div>
            <div class="input-group">
                <h3>2. ë©´ì ‘ ì§ˆë¬¸</h3>
                <select id="questionSelect">
                    <option value="ìê¸°ì†Œê°œ ë° ì§€ì›ë™ê¸°">ê°€. ìê¸°ì†Œê°œ ë° ì§€ì›ë™ê¸°</option>
                    <option value="ìì‹ ì˜ ì„±ê²©ì˜ ì¥ì ê³¼ ë‹¨ì ">ë‚˜. ìì‹ ì˜ ì„±ê²©ì˜ ì¥ì ê³¼ ë‹¨ì </option>
                    <option value="ì§€ì› í•™ê³¼ ê´€ë ¨ ê°€ì¥ ê¸°ì–µì— ë‚¨ëŠ” í™œë™">ë‹¤. ì§€ì› í•™ê³¼ ê´€ë ¨ ê°€ì¥ ê¸°ì–µì— ë‚¨ëŠ” í™œë™</option>
                    <option value="ì…í•™ í›„ êµ¬ì²´ì ì¸ í•™ì—… ê³„íš">ë¼. ì…í•™ í›„ êµ¬ì²´ì ì¸ í•™ì—… ê³„íš</option>
                    <option value="ë§ˆì§€ë§‰ìœ¼ë¡œ í•˜ê³  ì‹¶ì€ ë§">ë§ˆ. ë§ˆì§€ë§‰ìœ¼ë¡œ í•˜ê³  ì‹¶ì€ ë§</option>
                    <option value="custom">ë°”. (ì§ì ‘ ì…ë ¥)</option>
                </select>
                <input type="text" id="customQuestion" placeholder="ë©´ì ‘ ì§ˆë¬¸ì„ ì§ì ‘ ì…ë ¥í•˜ì„¸ìš”." style="display: none;">
            </div>
            <div class="output-group">
                <h3 style="display: flex; align-items: center;">3. í•™ìƒ ë‹µë³€ ë‚´ìš© <button id="copyBtn">ğŸ“‹ ë‹µë³€ ë³µì‚¬</button></h3>
                <div id="transcriptBox" class="output-box">ë‹µë³€ì„ ë…¹í™”í•˜ë©´ ìŒì„±ì¸ì‹ ê²°ê³¼ê°€ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤...</div>
            </div>
            <div class="output-group">
                <h3>4. AI í”¼ë“œë°± ë°›ê¸°</h3>
                <div class="output-box feedback-guide">
                    <p>1. ìœ„ 'ë‹µë³€ ë³µì‚¬' ë²„íŠ¼ì„ í´ë¦­í•˜ì„¸ìš”.<br>2. ì•„ë˜ 'í”¼ë“œë°± ë°›ê¸°' ë²„íŠ¼ì„ ëˆŒëŸ¬ ì±—ë´‡ì„ ì—¬ì„¸ìš”.<br>3. ì±—ë´‡ì—ê²Œ ë³µì‚¬í•œ ë‚´ìš©ì„ ë¶™ì—¬ë„£ê³  ì§ˆë¬¸í•˜ì„¸ìš”.</p>
                    <a href="https://chatgpt.com/g/g-68ce2135468c8191b14ed64164d81d30-ai-giban-moyi-myeonjeob-peurogeuraem" target="_blank">ğŸ¤– AI ê¸°ë°˜ í”¼ë“œë°± ë°›ê¸°</a>
                </div>
            </div>
        </div>
    </div>
<script>
    // --- 1. DOM ìš”ì†Œ ê°€ì ¸ì˜¤ê¸° ---
    const webcamVideo = document.getElementById("webcam");
    const flipBtn = document.getElementById("flipBtn");
    const pauseBtn = document.getElementById("pauseBtn");
    const recordBtn = document.getElementById("recordBtn");
    const saveBtn = document.getElementById("saveBtn");
    const timerDisplay = document.getElementById("timer");
    const questionSelect = document.getElementById("questionSelect");
    const customQuestionInput = document.getElementById("customQuestion");
    const countdownDisplay = document.getElementById("countdown");
    const transcriptBox = document.getElementById("transcriptBox");
    const copyBtn = document.getElementById("copyBtn");
    // --- 2. ìƒíƒœ ë³€ìˆ˜ ë° ê°ì²´ ì´ˆê¸°í™” ---
    let stream;
    let mediaRecorder;
    let recordedChunks = [];
    let isFlipped = false;
    let isPaused = false;
    let timerInterval = null;
    let seconds = 0;
    let fullTranscript = "";
    // ìŒì„± ì¸ì‹ API ì„¤ì •
    const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
    let recognition;
    if (SpeechRecognition) {
        recognition = new SpeechRecognition();
        recognition.continuous = true;
        recognition.interimResults = true;
        recognition.lang = "ko-KR";

        recognition.onresult = (event) => {
            let interimTranscript = "";
            let finalTranscript = "";
            for (let i = 0; i < event.results.length; i++) {
                const transcript = event.results[i][0].transcript;
                if (event.results[i].isFinal) {
                    finalTranscript += transcript;
                } else {
                    interimTranscript += transcript;
                }
            }
            transcriptBox.innerHTML = finalTranscript + '<i style="color:#999;">' + interimTranscript + "</i>";
            fullTranscript = finalTranscript.trim();
        };
        
        recognition.onerror = (event) => {
            transcriptBox.textContent = `ìŒì„± ì¸ì‹ ì˜¤ë¥˜: ${event.error}. í¬ë¡¬ ë¸Œë¼ìš°ì €ë¥¼ ì´ìš©í•´ ë³´ì„¸ìš”.`;
            console.error("Speech recognition error:", event.error);
        };

        // --- â˜…â˜…â˜… ìˆ˜ì • ë° ì¶”ê°€ëœ ë¶€ë¶„ â˜…â˜…â˜… ---
        // ì•ˆë“œë¡œì´ë“œ ê³„ì—´ ë¸Œë¼ìš°ì €ì—ì„œ ìŒì„± ì¸ì‹ì´ ë¹„ì •ìƒì ìœ¼ë¡œ ì¢…ë£Œë˜ëŠ” ê²ƒì„ ë°©ì§€í•˜ê³  ë‹¤ì‹œ ì‹œì‘í•˜ëŠ” ë¡œì§
        recognition.onend = () => {
            // mediaRecorderê°€ ì¡´ì¬í•˜ê³ , ë…¹í™” ì¤‘ì¼ ë•Œë§Œ ìŒì„± ì¸ì‹ì„ ë‹¤ì‹œ ì‹œì‘í•©ë‹ˆë‹¤.
            // ì‚¬ìš©ìê°€ 'ì¢…ë£Œ' ë²„íŠ¼ì„ ëˆŒëŸ¬ ì •ìƒì ìœ¼ë¡œ ë…¹í™”ê°€ ëë‚œ ê²½ìš°ì—ëŠ” ì¬ì‹œì‘í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.
            if (mediaRecorder && mediaRecorder.state === "recording") {
                console.log("ìŒì„± ì¸ì‹ì´ ì¤‘ë‹¨ë˜ì–´ ì¬ì‹œì‘í•©ë‹ˆë‹¤.");
                recognition.start();
            }
        };

    } else {
        transcriptBox.textContent = "í˜„ì¬ ë¸Œë¼ìš°ì €ì—ì„œëŠ” ìŒì„± ì¸ì‹ì„ ì§€ì›í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.";
    }

    // --- 3. í•µì‹¬ ê¸°ëŠ¥ í•¨ìˆ˜ ---

    // ì›¹ìº  ì„¤ì •
    async function setupWebcam() {
        try {
            stream = await navigator.mediaDevices.getUserMedia({ video: true, audio: true });
            webcamVideo.srcObject = stream;
        } catch (err) {
            alert("ì¹´ë©”ë¼ì™€ ë§ˆì´í¬ì— ì ‘ê·¼í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤. ê¶Œí•œì„ í™•ì¸í•´ì£¼ì„¸ìš”.");
            console.error("Error accessing media devices.", err);
        }
    }

    // ì‹œê°„ í¬ë§· ë³€ê²½ (00:00)
    function formatTime(totalSeconds) {
        const minutes = Math.floor(totalSeconds / 60);
        const seconds = totalSeconds % 60;
        return `${String(minutes).padStart(2, "0")}:${String(seconds).padStart(2, "0")}`;
    }

    // íƒ€ì´ë¨¸ ì‹œì‘
    function startTimer() {
        if (timerInterval) clearInterval(timerInterval);
        timerInterval = setInterval(() => {
            seconds++;
            timerDisplay.textContent = formatTime(seconds);
        }, 1000);
    }
    
    // íƒ€ì´ë¨¸ ì¤‘ì§€
    function stopTimer() {
        clearInterval(timerInterval);
        timerInterval = null;
    }

    // --- 4. ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì—°ê²° ---

    // ì¢Œìš° ë°˜ì „ ë²„íŠ¼
    flipBtn.addEventListener("click", () => {
        isFlipped = !isFlipped;
        webcamVideo.style.transform = isFlipped ? "scaleX(1)" : "scaleX(-1)";
    });

    // ì¼ì‹œ ì •ì§€ ë²„íŠ¼
    pauseBtn.addEventListener("click", () => {
        if (!mediaRecorder) return;

        if (isPaused) {
            // ì •ì§€ ìƒíƒœ -> ë‹¤ì‹œ ì‹œì‘
            mediaRecorder.resume();
            recognition?.start();
            startTimer();
            pauseBtn.innerHTML = "â¸ï¸";
            pauseBtn.title = "ì¼ì‹œ ì •ì§€";
        } else {
            // ë…¹í™” ìƒíƒœ -> ì¼ì‹œ ì •ì§€
            mediaRecorder.pause();
            recognition?.stop();
            stopTimer();
            pauseBtn.innerHTML = "â–¶ï¸";
            pauseBtn.title = "ë…¹í™” ì¬ê°œ";
        }
        isPaused = !isPaused;
    });

    // ë…¹í™” ì‹œì‘/ì¢…ë£Œ ë²„íŠ¼
    recordBtn.addEventListener("click", () => {
        if (mediaRecorder && mediaRecorder.state === "recording") {
            // ë…¹í™” ì¢…ë£Œ ë¡œì§
            mediaRecorder.stop();
            recognition?.stop();
            recordBtn.innerHTML = "ë…¹í™”";
            recordBtn.title = "ë…¹í™” ì‹œì‘";
            recordBtn.classList.remove("recording");
            saveBtn.disabled = false;
            pauseBtn.disabled = true;
            pauseBtn.innerHTML = "â¸ï¸"; // ì•„ì´ì½˜ ì´ˆê¸°í™”
            isPaused = false;
            stopTimer();

        } else {
            // ë…¹í™” ì‹œì‘ ë¡œì§
            let countdown = 3;
            countdownDisplay.style.display = "block";
            countdownDisplay.textContent = countdown;
            recordBtn.disabled = true;

            const countdownInterval = setInterval(() => {
                countdown--;
                if (countdown > 0) {
                    countdownDisplay.textContent = countdown;
                } else {
                    clearInterval(countdownInterval);
                    countdownDisplay.style.display = "none";
                    
                    recordBtn.disabled = false;
                    recordedChunks = [];
                    mediaRecorder = new MediaRecorder(stream);
                    mediaRecorder.ondataavailable = (event) => {
                        if (event.data.size > 0) recordedChunks.push(event.data);
                    };
                    
                    mediaRecorder.start();
                    recognition?.start();
                    
                    fullTranscript = "";
                    transcriptBox.textContent = "ìŒì„± ì¸ì‹ì´ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤...";
                    recordBtn.innerHTML = "ì¢…ë£Œ";
                    recordBtn.title = "ë…¹í™” ì¢…ë£Œ";
                    recordBtn.classList.add("recording");
                    saveBtn.disabled = true;
                    pauseBtn.disabled = false;

                    seconds = 0;
                    timerDisplay.textContent = "00:00";
                    startTimer();
                }
            }, 1000);
        }
    });

    // ì €ì¥ ë²„íŠ¼ (ì¦‰ì‹œ ë‹¤ìš´ë¡œë“œ)
    saveBtn.addEventListener("click", () => {
        if (recordedChunks.length === 0) {
            alert("ì €ì¥í•  ì˜ìƒ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.");
            return;
        }
        
        const blob = new Blob(recordedChunks, { type: "video/webm" });
        const url = URL.createObjectURL(blob);
 
        const a = document.createElement("a");
        
        // íŒŒì¼ëª… ìƒì„±
        const department = document.getElementById("department").value || "ë©´ì ‘ì—°ìŠµ";
        const date = new Date().toISOString().slice(0, 10);
        let questionText = questionSelect.options[questionSelect.selectedIndex].text.substring(3); // "ê°€. " ë¶€ë¶„ ì œê±°
        if (questionSelect.value === 'custom') {
            questionText = customQuestionInput.value || "ì§ì ‘ì…ë ¥ì§ˆë¬¸";
        }
        a.download = `${date}_${department}_${questionText}.webm`;

        // ì¦‰ì‹œ ë‹¤ìš´ë¡œë“œ ì‹¤í–‰
        a.href = url;
        document.body.appendChild(a);
        a.click();
        
        // ìƒì„±ëœ ìš”ì†Œ ì •ë¦¬
        document.body.removeChild(a);
        URL.revokeObjectURL(url);
        
        alert("ì˜ìƒ ë‹¤ìš´ë¡œë“œê°€ ì‹œì‘ë©ë‹ˆë‹¤!");
        saveBtn.disabled = true; // ì €ì¥ í›„ ë¹„í™œì„±í™”
    });

    // ì§ˆë¬¸ ì„ íƒ ë°•ìŠ¤
    questionSelect.addEventListener("change", () => {
        customQuestionInput.style.display = questionSelect.value === "custom" ? "block" : "none";
    });

    // ë‹µë³€ ë³µì‚¬ ë²„íŠ¼
    copyBtn.addEventListener('click', () => {
        if (!fullTranscript) {
            alert('ë³µì‚¬í•  ë‹µë³€ ë‚´ìš©ì´ ì—†ìŠµë‹ˆë‹¤.');
            return;
        }
        let currentQuestion = questionSelect.options[questionSelect.selectedIndex].text;
        if (questionSelect.value === "custom") {
            currentQuestion = customQuestionInput.value || "(ì§ì ‘ ì…ë ¥í•œ ì§ˆë¬¸)";
        }
        
        const textToCopy = `[ë©´ì ‘ ì§ˆë¬¸]\n${currentQuestion}\n\n[í•™ìƒ ë‹µë³€]\n${fullTranscript}`;
        
        navigator.clipboard.writeText(textToCopy).then(() => {
            copyBtn.textContent = 'âœ… ë³µì‚¬ ì™„ë£Œ!';
            setTimeout(() => { copyBtn.textContent = 'ğŸ“‹ ë‹µë³€ ë³µì‚¬'; }, 2000);
        }).catch(err => {
            console.error('ë³µì‚¬ ì‹¤íŒ¨:', err);
            alert('ë‹µë³€ì„ ë³µì‚¬í•˜ëŠ” ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
        });
    });

    // í˜ì´ì§€ ë¡œë“œ ì‹œ ì›¹ìº  ì„¤ì •
    window.addEventListener("load", setupWebcam);
</script>
</body>
</html>
